<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title></title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width">

        <link rel="stylesheet" href="style.css">
    </head>
    <body>
        <!--[if lt IE 7]>
            <p class="chromeframe">You are using an outdated browser. <a href="http://browsehappy.com/">Upgrade your browser today</a> or <a href="http://www.google.com/chromeframe/?redirect=true">install Google Chrome Frame</a> to better experience this site.</p>
        <![endif]-->

        <!-- Add your site or application content here -->
        <div id="main">
          
          <h1>The Cure</h1>
          <h2>Play Games, Defeat Cancer</h2>

          <div id="header">

            <div id="chart"></div>

            <div id="action">
              <input class="playnow" type="submit" value="Play Now" />

              <div id="email">
                <label for="email">Refer a Friend:</label><br />
                <input id="refEmail" class="email" type="email" name="usremail" placeholder="Email Address" />
                <input id="refName" class="email" type="email" name="usremail" placeholder="Your Name" />
                <p id="emailAlert" style="display: none;" ></p>
                <input class="emailsub" type="submit" value="Submit" />
              </div>
            </div>

            <div id="leaderboard">
              <h3>Leader Board</h3>
              <ol>

              </ol>

            </div>

          </div>

          <div class="section">
            <h2>How it works</h2>
              <ol>
                <li>People like you have different kinds of biological expertise, problem-solving abilities, and information-seeking strategies.</li>
                <li>Each of you plays a game that captures this human intelligence</li>
                <li>The player intelligence combined with artificial intelligence to form a novel, robust predictor of breast cancer prognosis</li>
                <li>Better determinations of prognosis result in more effective treatments</li>
                <li>More people defeat breast cancer!</li>
              </ol>
          </div>

        

        </div>

        <div id="footer">
          <div id="column">
            <p>The Su Laboratory</p>
            <p>Team <span class="pink">HIVE</span> in DREAM5 Competition</p>
            <p><span class="pink">Project Team:</span>Ben Good, Salvatore Loguercio, Max Nanis, Andrew Su</p>
            <a href="https://twitter.com/share" class="twitter-share-button" data-text="The Cure: Play games, Defeat Cancer" data-hashtags="thecure">Tweet</a>
            <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="http://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
          
          </div>
          <div id="column" class="right">
            <p><span class="pink">The Scripps Research Institute</span></p>
            <p>10550 North Torrey Pines Road</p>
            <p>La Jolla, CA 92037</p>


          </div>
        </div>
  <script src="js/libs/jquery-1.8.0.min.js"></script>
  <script src="js/libs/underscore-min.js"></script>
  <script src="js/libs/d3.v2.min.js"></script>
  <script type="text/javascript" charset="utf-8">

function drawGraph(data, targetEl){
    var format = d3.time.format.utc('%Y-%m-%e');
    
    var height = 200;
    var width = 200;

    var timeScale = d3.time.scale.utc().range([0, width]);
    var firstDomain = format.parse('2012-9-1');
    var secondDomain = format.parse('2012-9-30');
    timeScale.domain([firstDomain, secondDomain])

    var y = d3.scale.linear()
      .domain([0, 1])
      .range([height,0]);

    // axes
    var xAxis = d3.svg.axis().scale(timeScale);
    var yAxis = d3.svg.axis().scale(y).orient('left');

    var graphSvg = d3.select(targetEl).append("svg:svg");

    graphSvg.append('g')
      .attr('class', 'x_axis')
      .attr('transform', 'translate(25,'+(height+5)+')')
      .call(xAxis.ticks(7).tickFormat(d3.time.format('%d')));

    graphSvg.append('g')
      .attr('class', 'y_axis')
      .attr('transform', 'translate(25,5)')
      .call(yAxis);
    
    graphSvg.append('g')
      .attr('class', 'guide_lines_x')
      .attr('transform', 'translate(25,'+ (height+5) +')')
      .call(xAxis.tickFormat('').tickSize(-height,0,0));
  
    graphSvg.append('g')
      .attr('class', 'guide_lines_y')
      .attr('transform', 'translate(25,5)')
      .call(yAxis.tickFormat('').tickSize(-width,0,0));

    var line = d3.svg.line()
      .x(function(d) { return timeScale( d.timestamp ) })
      .y(function(d) { return y( d.y ) });
    
    graphSvg.append('g')
      .attr('transform', 'translate('+(-width)+', 5)')
      .append('path')
      .attr('class', 'line')
      .attr('d', line( data.chart ));

    graphSvg.append('g')
      .attr('class', 'points')
      .attr('transform', 'translate('+(-width)+', 5)').selectAll('circle')
      .data( data.chart ).enter()
      .append('circle')
        .attr('r', 1.5)
        .attr('cx', function(d){ return timeScale( d.timestamp ); })
        .attr('cy', function(d){ return y( d.y ); })
  }

    function fillTopScores(data) {
      console.log(data.leaderboard);
      var olEl = $("div#leaderboard ol");
      var leaders = _.sortBy(data.leaderboard, function(obj) { return -obj.score; });
      console.log(leaders);
      _( _.first(leaders, 6) ).each(function(v, i) {
        olEl.append('<li><span class="username">'+v.username+'</span> <span class="score">'+v.score+'</span></li>')
       })
   }

    $(document).ready(function() {
      ////////////////////////////////////////////////////////////////
      // Here is where the data var will be prebuild by ben's jsp side
      ////////////////////////////////////////////////////////////////
      var data = {};
      data.chart = d3.range(20).map(function(i) {
        return {timestamp: ( new Date(2012, 9, (i+6), 1, 1, 23, 23).getTime() ), y: (Math.sin(i / 3) + 1) / 2};
      });
      data.leaderboard = d3.range(10).map(function(i) {
          return {username: ("username" + i), score: 1000-(i*50)}
      })
      ////////////////////////////////////////////////////////////////

      drawGraph(data, "#chart");
      fillTopScores(data);
        function validateEmail(email) {
          var re = /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,6}$/;
          var emailEl = $("input#refEmail"),
              isValid = re.test(email);
          if (isValid) {
            emailEl.css({"boxShadow":"0px 0px 4px 0px #20282B"});
          } else {
            emailEl.css({"boxShadow":"0px 0px 8px 0px red"});
          }
          return isValid;
        }

        function submitEmail(email, name) {
          // /cure/SocialServer?command=invite&by=jessesmith&invited=sam@smith.org
        $.get("/cure/SocialServer", { command: "invite", by: name, invited: email } )
          .success(function(d) {
            $("#emailAlert").html("Thank You!").fadeIn();
            return true;
          })
          .error(function(d) {
            $("#emailAlert").html("Sorry, error occured :(").fadeIn();
            return false;
          });
          return false;
        }

        $("input#refEmail").blur(function() {
          var email = $("input#refEmail").val();
          validateEmail(email)
        })

        $(".emailsub").click(function() {
          var email = $("input#refEmail");
          var name = $("input#refName");
          if( validateEmail( email.val() ) ) {
            if( submitEmail( email.val(), name.val() ) ) {
              email.val("");
              name.val("");
            };
          }
        })

        $("input.playnow").click(function(e) {
            //link to the game, need to do anything else?
            var gameUrl = "login.jsp";
            window.open(gameUrl);
            return false;
        })

    });
  </script>
  </body>
</html>
